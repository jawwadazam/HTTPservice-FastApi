# HTTP Service

## Problem Statement

> Our customers are sending billions of requests each day that need to be processed. Today, all incoming requests are processed regardless of their validity, leading to slower processing. We want to filter out invalid requests (badly formatted, containing invalid values, missing required fields, â€¦) but keep a history on a day-by-day basis so that we can properly charge customers for the traffic they send.

## Installation
### Using Code
> This service requires [Python](https://www.python.org/) v3.7+ to run.

Install pipenv to install the dependencies and devDependencies

```pip install pipenv
pipenv install
```
To active the pipenv virtual environment
```
pipenv shell
```

To start the application
```
uvicorn api:app
```
### Using Docker

By default, the Docker will expose port 8000, so change this within the Dockerfile if necessary. When ready, simply use the Dockerfile to build the image.

```sh
cd <directory-containing-dockerfile>
docker build -t <buildImageTag> .
```

This will create the serivce image and pull in the necessary dependencies.

Once done, run the Docker image and map the port to whatever you wish on your host. In this example, we simply map port 8080 of the host to port 8000 of the Docker (or whatever port was exposed in the Dockerfile):

```sh
docker run -p 8080:8000 <buildImageTag>
```

>
Verify the deployment by navigating to your server address in your preferred browser.

```sh
127.0.0.1:8000/docs
```

### Using Docker Image from Docker Hub
## Usage

### Process incoming requests
- receives requests generated by our collector
- check the validity of each request
- reject invalid requests

```
Method : POST
URI : /api/
body: json
json format: {"customerID":int,"tagID":int,"userID":str,"remoteIP":str,"timestamp":datetime}
```
### Get stats by customer for a particular date
```
Method : GET
URI : /api/stats/{customer_id}/{date}/
```

### Get stats by customer for a particular date and Hour
```
Method : GET
URI : /api/stats/{customer_id}/{date}/{hour}
```
### Get stats for a particular date
```
Method : GET
URI : /api/stats/{date}/
```

### Get stats for a particular date and Hour
```
Method : GET
URI : /api/stats/{date}/{hour}
```

Also for further documentation for usage please visit the http://127.0.0.1:8000/docs or http://127.0.0.1:8000/redoc after running the application
> Note: `127.0.0.1:8000` is the deafult configuration, please replace the IP and port with your appropriate IP and port
